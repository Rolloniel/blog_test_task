(function(c,a){if(typeof define==="function"&&define.amd){define([],a)}else{if(typeof exports!=="undefined"){a()}else{var b={exports:{}};a();c.bootstrapTablePipeline=b.exports}}})(this,function(){(function(e){var g=e.fn.bootstrapTable.utils;e.extend(e.fn.bootstrapTable.defaults,{usePipeline:false,pipelineSize:1000,onCachedDataHit:function b(k){return false},onCachedDataReset:function c(k){return false}});e.extend(e.fn.bootstrapTable.Constructor.EVENTS,{"cached-data-hit.bs.table":"onCachedDataHit","cached-data-reset.bs.table":"onCachedDataReset"});var a=e.fn.bootstrapTable.Constructor,h=a.prototype.init,d=a.prototype.initServer,j=a.prototype.onSearch,i=a.prototype.onSort,f=a.prototype.onPageListChange;a.prototype.init=function(){this.initPipeline();h.apply(this,Array.prototype.slice.apply(arguments))};a.prototype.initPipeline=function(){this.cacheRequestJSON={};this.cacheWindows=[];this.currWindow=0;this.resetCache=true};a.prototype.onSearch=function(k){if(this.options.usePipeline){this.resetCache=true}j.apply(this,Array.prototype.slice.apply(arguments))};a.prototype.onSort=function(k){if(this.options.usePipeline){this.resetCache=true}i.apply(this,Array.prototype.slice.apply(arguments))};a.prototype.onPageListChange=function(l){var m=e(l.currentTarget);var k=parseInt(m.text());this.options.pipelineSize=this.calculatePipelineSize(this.options.pipelineSize,k);this.resetCache=true;f.apply(this,Array.prototype.slice.apply(arguments))};a.prototype.calculatePipelineSize=function(l,k){if(k==0){return 0}return Math.ceil(l/k)*k};a.prototype.setCacheWindows=function(){this.cacheWindows=[];var m=this.options.totalRows/this.options.pipelineSize;for(var l=0;l<=m;l++){var k=l*this.options.pipelineSize;this.cacheWindows[l]={lower:k,upper:k+this.options.pipelineSize-1}}};a.prototype.setCurrWindow=function(l){this.currWindow=0;for(var k=0;k<this.cacheWindows.length;k++){if(this.cacheWindows[k].lower<=l&&l<=this.cacheWindows[k].upper){this.currWindow=k;break}}};a.prototype.drawFromCache=function(o,k){var l=e.extend(true,{},this.cacheRequestJSON);var n=o-this.cacheWindows[this.currWindow].lower;var m=n+k;l.rows=l.rows.slice(n,m);return l};a.prototype.initServer=function(p,s,k){var n={};var o=this.header.fields.indexOf(this.options.sortName);var l={searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder};var m=null;if(this.header.sortNames[o]){l.sortName=this.header.sortNames[o]}if(this.options.pagination&&this.options.sidePagination==="server"){l.pageSize=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize;l.pageNumber=this.options.pageNumber}if(!(k||this.options.url)&&!this.options.ajax){return}var x=true;if(this.options.queryParamsType==="limit"){l={searchText:l.searchText,sortName:l.sortName,sortOrder:l.sortOrder};if(this.options.pagination&&this.options.sidePagination==="server"){l.limit=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize;l.offset=(this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize)*(this.options.pageNumber-1);if(this.options.usePipeline){if(!this.cacheWindows.length){x=true;l.drawOffset=l.offset}else{var t=this.cacheWindows[this.currWindow];if(this.resetCache||l.offset<t.lower||l.offset>t.upper){x=true;this.setCurrWindow(l.offset);l.drawOffset=l.offset;l.offset=this.cacheWindows[this.currWindow].lower}else{x=false}}}else{if(l.limit===0){delete l.limit}}}}if(this.resetCache){x=true;this.resetCache=false}if(this.options.usePipeline&&x){l.drawLimit=l.limit;l.limit=this.options.pipelineSize}if(!x){var q=this.drawFromCache(l.offset,l.limit);this.load(q);this.trigger("load-success",q);this.trigger("cached-data-hit",q);return}if(!e.isEmptyObject(this.filterColumnsPartial)){l.filter=JSON.stringify(this.filterColumnsPartial,null)}n=g.calculateObjectValue(this.options,this.options.queryParams,[l],n);e.extend(n,s||{});if(n===false){return}if(!p){this.$tableLoading.show()}var v=this;m=e.extend({},g.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:k||this.options.url,data:this.options.contentType==="application/json"&&this.options.method==="post"?JSON.stringify(n):n,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function u(w){w=g.calculateObjectValue(v.options,v.options.responseHandler,[w],w);if(v.options.usePipeline){v.cacheRequestJSON=e.extend(true,{},w);v.options.totalRows=w[v.options.totalField];v.setCacheWindows();v.setCurrWindow(l.drawOffset);w=v.drawFromCache(l.drawOffset,l.drawLimit);v.trigger("cached-data-reset",w)}v.load(w);v.trigger("load-success",w);if(!p){v.$tableLoading.hide()}},error:function r(w){var y=[];if(v.options.sidePagination==="server"){y={};y[v.options.totalField]=0;y[v.options.dataField]=[]}v.load(y);v.trigger("load-error",w.status,w);if(!p){v.$tableLoading.hide()}}});if(this.options.ajax){g.calculateObjectValue(this,this.options.ajax,[m],null)}else{if(this._xhr&&this._xhr.readyState!==4){this._xhr.abort()}this._xhr=e.ajax(m)}};e.fn.bootstrapTable.methods.push()})(jQuery)});